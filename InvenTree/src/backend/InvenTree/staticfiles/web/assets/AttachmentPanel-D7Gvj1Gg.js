import{r as n,i as a,j as t,au as J,aY as L,S as B,J as V,G as C,d7 as w,aw as Y,m as I,bC as Z,n as D,ar as q,ci as Q}from"./vendor-9x6k4T-r.js";import{a as h}from"./NotesPanel-BWqAJJ8r.js";import{u as H,a as K,b as O,c as T}from"./UseForm-C7xHtQGh.js";import{A as v}from"./AttachmentLink-r3l6VS50.js";import{u as W}from"./DesktopAppView-D7dqNL6j.js";import{a as X}from"./formatters-MBbtNL9a.js";import{c as $,e as N,A as y}from"./index-Bd_yPD7D.js";import{u as ee,R as te,a as ae,I as se}from"./InvenTreeTable-KDc6oHjF.js";function ne(){return[{accessor:"attachment",sortable:!1,switchable:!1,noWrap:!0,render:e=>e.attachment?t.jsx(v,{attachment:e.attachment}):e.link?t.jsx(v,{attachment:e.link,external:!0}):"-",noContext:!0},{accessor:"comment",sortable:!1,render:e=>e.comment},{accessor:"upload_date",sortable:!0,render:e=>t.jsxs(C,{justify:"space-between",children:[t.jsx(I,{children:e.upload_date}),e.user_detail&&t.jsx(Z,{size:"xs",children:e.user_detail.username})]})},{accessor:"file_size",sortable:!0,switchable:!0,render:e=>e.attachment?X(e.file_size):"-"}]}function oe({model_type:e,model_id:o}){const M=W(),r=$(),i=ee(`${e}-attachments`),P=n.useMemo(()=>ne(),[]),c=N(y.attachment_list),j=n.useMemo(()=>o>0,[o]),p=n.useMemo(()=>r.hasDeletePermission(e),[r,e]),[E,k]=n.useState(!1),_=n.useMemo(()=>r.hasAddPermission(e),[r,e]);function z(s){s.forEach(b=>{const m=new FormData;m.append("attachment",b),m.append("model_type",e),m.append("model_id",o.toString()),k(!0),M.post(c,m).then(u=>(D.show({title:a._({id:"FJqE4H"}),message:a._({id:"3LxYDr",values:{0:b.name}}),color:"green"}),i.refreshTable(),u)).catch(u=>(console.error("error uploading attachment:",b,"->",u),D.show({title:a._({id:"ae3dey"}),message:a._({id:"GZnmeE"}),color:"red"}),u)).finally(()=>{k(!1)})})}const[x,A]=n.useState("attachment"),[l,d]=n.useState(void 0),g=n.useMemo(()=>{const s={model_type:{value:e,hidden:!0},model_id:{value:o,hidden:!0},attachment:{},link:{},comment:{}};return x!="link"&&delete s.link,(x!="attachment"||l)&&delete s.attachment,s},[e,o,x,l]),f=H({url:c,title:a._({id:"p1w/D6"}),fields:g,onFormSuccess:()=>{i.refreshTable()}}),S=K({url:c,pk:l,title:a._({id:"MVvhJ1"}),fields:g,onFormSuccess:s=>{s.pk?i.updateRecord(s):i.refreshTable()}}),F=O({url:c,pk:l,title:a._({id:"hZfPb3"}),onFormSuccess:()=>{i.refreshTable()}}),R=n.useMemo(()=>[{name:"is_link",label:a._({id:"3QegpG"}),description:a._({id:"r1FQZj"})},{name:"is_file",label:a._({id:"JT83gz"}),description:a._({id:"5LI39K"})}],[]),U=n.useMemo(()=>[t.jsx(T,{tooltip:a._({id:"V8euYO"}),hidden:!r.hasAddPermission(e),icon:t.jsx(J,{}),onClick:()=>{A("attachment"),d(void 0),f.open()}},"add-attachment"),t.jsx(T,{tooltip:a._({id:"DpV4ac"}),hidden:!r.hasAddPermission(e),icon:t.jsx(L,{}),onClick:()=>{A("link"),d(void 0),f.open()}},"add-external-link")],[r,e]),G=n.useCallback(s=>[te({hidden:!r.hasChangePermission(e),onClick:()=>{d(s.pk),S.open()}}),ae({hidden:!p,onClick:()=>{d(s.pk),F.open()}})],[r,e]);return t.jsxs(t.Fragment,{children:[f.modal,S.modal,F.modal,t.jsxs(B,{gap:"xs",children:[j&&t.jsx(se,{url:c,tableState:i,columns:P,props:{noRecordsText:a._({id:"32o8IC"}),enableSelection:p,enableBulkDelete:p,tableActions:U,tableFilters:R,rowActions:G,params:{model_type:e,model_id:o}}},"attachment-table"),_&&j&&t.jsx(V,{p:"md",shadow:"xs",radius:"md",children:t.jsx(h,{onDrop:z,loading:E,children:t.jsxs(C,{justify:"center",gap:"lg",mih:100,children:[t.jsx(h.Accept,{children:t.jsx(w,{style:{color:"var(--mantine-color-blue-6)"},stroke:1.5})}),t.jsx(h.Reject,{children:t.jsx(Y,{style:{color:"var(--mantine-color-red-6)"},stroke:1.5})}),t.jsx(h.Idle,{children:t.jsx(w,{style:{color:"var(--mantine-color-dimmed)"},stroke:1.5})}),t.jsx(I,{size:"sm",children:a._({id:"1cbxaa"})})]})},"attachment-dropzone")})]})]})}function pe({model_type:e,model_id:o}){return{name:"attachments",label:a._({id:"w/Sphq"}),icon:t.jsx(q,{}),content:e&&o?t.jsx(oe,{model_type:e,model_id:o}):t.jsx(Q,{})}}export{pe as A};
