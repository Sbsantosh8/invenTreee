import{r as d,j as t,ci as Y,i,cT as u,Z as R,a1 as Q,S as q}from"./vendor-9x6k4T-r.js";import{P as Z}from"./PrimaryActionButton-CaaZRKkp.js";import{l as G}from"./InvenTreeTable-KDc6oHjF.js";import{I as N,D as j,a as $}from"./InstanceDetail-B4p22K57.js";import{D as _}from"./DetailsBadge-jKGz3Eqm.js";import{D as z,N as H}from"./NotesPanel-BWqAJJ8r.js";import{B as K,O as L,E as V,C as X}from"./ActionDropdown-DlGcqXhK.js";import{P as W}from"./PageDetail-DJvgu_vJ.js";import{A as J}from"./AttachmentPanel-D7Gvj1Gg.js";import{P as ee}from"./PanelGroup-BCG3mCoU.js";import{f as A}from"./formatters-MBbtNL9a.js";import{c as te,A as o,m as r,U as F,f as v}from"./index-Bd_yPD7D.js";import{e as ie,f as se}from"./SalesOrderForms-DbF3BT5u.js";import{a as re,b as ae,u as ne}from"./UseForm-C7xHtQGh.js";import{u as D}from"./UseInstance-Cb46b_w1.js";import{S as oe}from"./SalesOrderAllocationTable-DmnKSDhS.js";import{C as le,e as de}from"./ThemeContext-DRe09WSE.js";import"./DesktopAppView-D7dqNL6j.js";import"./navigation-BUwul1Ze.js";import"./dayjs.min-DUmzidR_.js";import"./YesNoButton-BsHbI51V.js";import"./ColumnRenderers-CTwRHGdM.js";import"./Instance-ZaRjKoLj.js";import"./ApiIcon-BBFuOj6_.js";import"./GenericErrorPage-C2ho8aty.js";import"./NotFound-o4Sp_RYV.js";import"./PermissionDenied-Di_W_uvf.js";import"./PageTitle-D--W0kLm.js";import"./AttachmentLink-r3l6VS50.js";import"./RemoteComponent-C0S0OuAi.js";import"./RemoveRowButton-PzDbXrvR.js";function Ge(){var y,x,k;const{id:P}=le(),m=te(),I=de(),{instance:e,instanceQuery:l,refreshInstance:h,requestStatus:C}=D({endpoint:o.sales_order_shipment_list,pk:P,params:{order_detail:!0}}),{instance:s,instanceQuery:p,refreshInstance:me,requestStatus:pe}=D({endpoint:o.company_list,pk:(y=e.order_detail)==null?void 0:y.customer,hasPrimaryKey:!0}),a=d.useMemo(()=>!e.shipment_date,[e]),f=d.useMemo(()=>{var S;if(l.isFetching||p.isFetching)return t.jsx(Y,{});const n={...e,customer:s==null?void 0:s.pk,customer_name:s==null?void 0:s.name,customer_reference:(S=e.order_detail)==null?void 0:S.customer_reference},O=[{type:"link",model:r.salesorder,name:"order",label:i._({id:"LozYBo"}),icon:"sales_orders",model_field:"reference"},{type:"link",name:"customer",icon:"customers",label:i._({id:"876pfE"}),model:r.company,model_field:"name",hidden:!n.customer},{type:"text",name:"customer_reference",icon:"serial",label:i._({id:"ZVUe1A"}),hidden:!n.customer_reference,copy:!0},{type:"text",name:"reference",icon:"serial",label:i._({id:"Dwgrby"}),copy:!0},{type:"text",name:"allocated_items",icon:"packages",label:i._({id:"sdy17V"})}],w=[{type:"text",name:"tracking_number",label:i._({id:"DTku8S"}),icon:"trackable",value_formatter:()=>e.tracking_number||"---",copy:!!e.tracking_number},{type:"text",name:"invoice_number",label:i._({id:"MhyecB"}),icon:"serial",value_formatter:()=>e.invoice_number||"---",copy:!!e.invoice_number},{type:"text",name:"shipment_date",label:i._({id:"MFQxyA"}),icon:"calendar",value_formatter:()=>A(e.shipment_date),hidden:!e.shipment_date},{type:"text",name:"delivery_date",label:i._({id:"ovm9ir"}),icon:"calendar",value_formatter:()=>A(e.delivery_date),hidden:!e.delivery_date},{type:"link",external:!0,name:"link",label:i._({id:"yzF66j"}),copy:!0,hidden:!e.link}];return t.jsx(t.Fragment,{children:t.jsxs(N,{children:[t.jsxs(u,{children:[t.jsx(u.Col,{span:4,children:t.jsx(z,{appRole:F.sales_order,apiPath:o.company_list,src:s==null?void 0:s.image,pk:s==null?void 0:s.pk,imageActions:{selectExisting:!1,downloadImage:!1,uploadFile:!1,deleteFile:!1}})}),t.jsx(u.Col,{span:8,children:t.jsx(j,{fields:O,item:n})})]}),t.jsx(j,{fields:w,item:n})]})})},[e,l,s,p]),M=d.useMemo(()=>[{name:"detail",label:i._({id:"aaEiwW"}),icon:t.jsx(R,{}),content:f},{name:"items",label:i._({id:"9dk0UT"}),icon:t.jsx(Q,{}),content:t.jsx(oe,{shipmentId:e.pk,showPartInfo:!0,allowEdit:a,modelField:"item",modelTarget:r.stockitem})},J({model_type:r.salesordershipment,model_id:e.pk}),H({model_type:r.salesordershipment,model_id:e.pk})],[a,e,f]),E=ie({pending:a}),c=re({url:o.sales_order_shipment_list,pk:e.pk,fields:E,title:i._({id:"rX/5YH"}),onFormSuccess:h}),g=ae({url:o.sales_order_shipment_list,pk:e.pk,title:i._({id:"YAsuZ2"}),onFormSuccess:()=>{I(v(r.salesorder,e.order))}}),T=se({}),b=ne({url:o.sales_order_shipment_complete,pk:e.pk,fields:T,title:i._({id:"/IxVda"}),focus:"tracking_number",initialData:{...e,shipment_date:new Date().toISOString().split("T")[0]},onFormSuccess:h}),U=d.useMemo(()=>l.isFetching?[]:[t.jsx(_,{label:i._({id:"UbRKMZ"}),color:"gray",visible:a},"pending"),t.jsx(_,{label:i._({id:"AoOqHM"}),color:"green",visible:!a},"shipped"),t.jsx(_,{label:i._({id:"BTOhSm"}),color:"blue",visible:!!e.delivery_date},"delivered")],[a,e.deliveryDate,l.isFetching]),B=d.useMemo(()=>{const n=m.hasChangePermission(r.salesordershipment);return[t.jsx(Z,{title:i._({id:"1mYYQ6"}),icon:"sales_orders",hidden:!a,color:"green",onClick:()=>{b.open()}},"send-shipment"),t.jsx(K,{model:r.salesordershipment,pk:e.pk},"barcode"),t.jsx(G,{modelType:r.salesordershipment,items:[e.pk],enableLabels:!0,enableReports:!0},"print"),t.jsx(L,{tooltip:i._({id:"8ijAtN"}),actions:[V({hidden:!n,onClick:c.open,tooltip:i._({id:"rX/5YH"})}),X({hidden:!a,onClick:g.open,tooltip:i._({id:"YAsuZ2"})})]},"actions")]},[a,m,e]);return t.jsxs(t.Fragment,{children:[b.modal,c.modal,g.modal,t.jsx($,{status:C,loading:l.isFetching||p.isFetching,requiredRole:F.sales_order,children:t.jsxs(q,{gap:"xs",children:[t.jsx(W,{title:`${i._({id:"qGSobR"})}: ${e.reference}`,subtitle:`${i._({id:"LozYBo"})}: ${(x=e.order_detail)==null?void 0:x.reference}`,breadcrumbs:[{name:i._({id:"mUv9U4"}),url:"/sales/"},{name:(k=e.order_detail)==null?void 0:k.reference,url:v(r.salesorder,e.order)}],badges:U,imageUrl:s==null?void 0:s.image,editAction:c.open,editEnabled:m.hasChangePermission(r.salesordershipment),actions:B}),t.jsx(ee,{pageKey:"salesordershipment",panels:M,model:r.salesordershipment,instance:e,id:e.pk})]})})]})}export{Ge as default};
