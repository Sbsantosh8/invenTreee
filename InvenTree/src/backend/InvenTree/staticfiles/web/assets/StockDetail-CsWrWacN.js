import{i as t,r as i,j as s,bs as Ve,ci as K,bA as we,G as L,m as Z,by as xe,bC as fe,Z as ve,s as ye,I as Oe,aB as We,bD as U,cT as X,bu as Ye,en as Ge,bI as P,eo as Le,ep as Je,bk as Qe,bG as He,a1 as Xe,a6 as $e,S as Ze}from"./vendor-9x6k4T-r.js";import{A as et}from"./AdminButton-Dr56qn7X.js";import{u as ee,I as te,R as tt,a as st,m as at,Y as lt,l as it}from"./InvenTreeTable-KDc6oHjF.js";import{I as ot,D as J,a as nt}from"./InstanceDetail-B4p22K57.js";import{D as w}from"./DetailsBadge-jKGz3Eqm.js";import{D as rt,N as dt}from"./NotesPanel-BWqAJJ8r.js";import{B as ct,A as ut,O as pt,a as mt,E as _t,D as bt}from"./ActionDropdown-DlGcqXhK.js";import{e as Te,C as kt,S as je,I as R}from"./ThemeContext-DRe09WSE.js";import{N as ht}from"./NavigationTree-Dl2ZR6jN.js";import{P as xt}from"./PageDetail-DJvgu_vJ.js";import{A as ft}from"./AttachmentPanel-D7Gvj1Gg.js";import{P as yt}from"./PanelGroup-BCG3mCoU.js";import{L as jt}from"./LocateItemButton-MOm055uP.js";import{b as Me,f as ge,S as Pe,d as gt,h as St,i as It,j as At,k as Ct,l as wt,m as vt}from"./Instance-ZaRjKoLj.js";import{O as Tt}from"./OrderPartsWizard-BpRHlLRb.js";import{u as Re}from"./DesktopAppView-D7dqNL6j.js";import{f as Se,b as Ie}from"./formatters-MBbtNL9a.js";import{c as se,e as v,A as p,m as o,U as b,l as De,f as $}from"./index-Bd_yPD7D.js";import{b as Mt,c as Pt,d as Ae,S as Rt,e as Ce,u as Dt,f as Ft,g as qt,a as zt,h as Et,i as Bt}from"./StockItemTable-C1bOB_vf.js";import{u as z,A as Fe,a as qe,b as ze}from"./UseForm-C7xHtQGh.js";import{u as Ut}from"./UseInstance-Cb46b_w1.js";import{B as Kt}from"./BuildAllocatedStockTable-DIckwP_R.js";import{S as Nt}from"./SalesOrderAllocationTable-DmnKSDhS.js";import{a as Vt,S as Ot,D as Ee,N as Wt,j as Be}from"./ColumnRenderers-CTwRHGdM.js";import{P as Yt}from"./YesNoButton-BsHbI51V.js";import{A as Gt}from"./AttachmentLink-r3l6VS50.js";import{b as Lt}from"./UseFilter-DqHeVZaa.js";import"./navigation-BUwul1Ze.js";import"./dayjs.min-DUmzidR_.js";import"./GenericErrorPage-C2ho8aty.js";import"./NotFound-o4Sp_RYV.js";import"./PermissionDenied-Di_W_uvf.js";import"./ApiIcon-BBFuOj6_.js";import"./PageTitle-D--W0kLm.js";import"./RemoteComponent-C0S0OuAi.js";import"./CompanyForms-BzJpK2Vu.js";import"./PurchaseOrderForms-CTnFU4km.js";import"./RemoveRowButton-PzDbXrvR.js";import"./UseGenerator-BZWzvoyo.js";import"./UsePlaceholder-C_lBT7aw.js";import"./SalesOrderForms-DbF3BT5u.js";function Jt({stockItem:d}){var T;const n=ee("stock_item_install"),u=se(),h=Mt({stockItem:d}),_=z({url:v(p.stock_install),pk:d.pk,title:t._({id:"erPDED"}),table:n,successMessage:t._({id:"g+zcGQ"}),fields:h}),[C,j]=i.useState({}),k=Pt(),e=z({url:v(p.stock_uninstall),pk:C.pk,title:t._({id:"q2BZiX"}),table:n,successMessage:t._({id:"ibtYlF"}),fields:k,initialData:{location:d.location??((T=d.part_detail)==null?void 0:T.default_location)}}),g=i.useMemo(()=>[{accessor:"part",switchable:!1,render:m=>Vt({part:m==null?void 0:m.part_detail})},{accessor:"quantity",switchable:!1,render:m=>{let I=m.quantity;return m.serial&&m.quantity==1&&(I=`# ${m.serial}`),I}},{accessor:"batch",switchable:!1},Ot({model:o.stockitem})],[]),f=i.useMemo(()=>{var m;return[s.jsx(Fe,{tooltip:t._({id:"erPDED"}),onClick:()=>{_.open()},hidden:!u.hasChangeRole(b.stock)||d.is_building||((m=d.part_detail)==null?void 0:m.assembly)!=!0},"install")]},[d,u]),S=i.useCallback(m=>[{title:t._({id:"fo0VXg"}),tooltip:t._({id:"mGSvSz"}),onClick:()=>{j(m),e.open()},icon:s.jsx(Ve,{}),hidden:!u.hasChangeRole(b.stock)}],[u]);return s.jsxs(s.Fragment,{children:[_.modal,e.modal,d.pk?s.jsx(te,{url:v(p.stock_item_list),tableState:n,columns:g,props:{tableActions:f,rowActions:S,modelType:o.stockitem,params:{belongs_to:d.pk,part_detail:!0}}}):s.jsx(K,{})]})}function Qt({partId:d,itemId:n}){const u=Re(),h=se(),_=ee("stocktests"),C=De(),j=i.useMemo(()=>C.isSet("TEST_STATION_DATA"),[C]),{data:k}=we({queryKey:["stocktesttemplates",d,n],queryFn:async()=>d?u.get(v(p.part_test_template_list),{params:{part:d,include_inherited:!0,enabled:!0}}).then(a=>a.data).catch(a=>[]):[]});i.useEffect(()=>{_.refreshTable()},[k]);const e=i.useCallback(a=>{const c=k.map(r=>({...r,templateId:r.pk,results:[]}));return a.forEach(r=>{c.find(x=>x.templateId==r.template)||c.push({...r.template_detail,templateId:r.template,results:[]})}),a.sort((r,x)=>r.pk>x.pk?1:-1).forEach(r=>{const x=c.findIndex(M=>M.templateId==r.template);x>=0&&(c[x]={...c[x],...r},c[x].results.push(r))}),c},[d,n,k]),g=i.useMemo(()=>[{accessor:"test",title:t._({id:"NnH3pK"}),switchable:!1,sortable:!0,render:a=>{var x,M;const c=a.enabled??((x=a.template_detail)==null?void 0:x.enabled),r=a.stock_item!=null&&a.stock_item!=n;return s.jsxs(L,{justify:"space-between",wrap:"nowrap",children:[s.jsxs(Z,{style:{fontStyle:r?"italic":void 0},c:c?void 0:"red",children:[!a.templateId&&"- ",a.test_name??((M=a.template_detail)==null?void 0:M.test_name)]}),s.jsxs(L,{justify:"right",children:[a.results&&a.results.length>1&&s.jsx(xe,{label:t._({id:"isbwWo"}),children:s.jsx(fe,{color:"lightblue",variant:"filled",children:a.results.length})}),r&&s.jsx(xe,{label:t._({id:"yd1WJ/"}),children:s.jsx(ve,{size:16,color:"blue"})})]})]})}},{accessor:"result",title:t._({id:"RD6AE9"}),switchable:!1,sortable:!0,render:a=>a.result===void 0?s.jsx(fe,{color:"lightblue",variant:"filled",children:t._({id:"4bobEy"})}):s.jsx(Yt,{value:a.result})},Ee({accessor:"description"}),{accessor:"value",title:t._({id:"wMHvYH"})},{accessor:"attachment",title:t._({id:"UY1vmE"}),render:a=>a.attachment&&s.jsx(Gt,{attachment:a.attachment}),noContext:!0},Wt({}),Be({}),{accessor:"user",title:t._({id:"7PzzBU"}),sortable:!1,render:a=>a.user_detail&&s.jsx(Me,{instance:a.user_detail})},{accessor:"test_station",sortable:!0,title:t._({id:"18Lf3c"}),hidden:!j},{accessor:"started_datetime",sortable:!0,title:t._({id:"JEGlfK"}),hidden:!j,render:a=>s.jsx(L,{justify:"space-between",children:Se(a.started_datetime,{showTime:!0,showSeconds:!0})})},{accessor:"finished_datetime",sortable:!0,title:t._({id:"4dQFvz"}),hidden:!j,render:a=>s.jsx(L,{justify:"space-between",children:Se(a.finished_datetime,{showTime:!0,showSeconds:!0})})}],[n,j]),[f,S]=i.useState(void 0),T=Ae({partId:d,itemId:n,templateId:f,editing:!1}),m=Ae({partId:d,itemId:n,templateId:f,editing:!0}),I=z({url:p.stock_test_result_list,fields:i.useMemo(()=>({...T}),[T]),initialData:{template:f,result:!0},title:t._({id:"VzkBcq"}),table:_,successMessage:t._({id:"VivtT0"})}),[D,F]=i.useState(0),E=qe({url:p.stock_test_result_list,pk:D,fields:i.useMemo(()=>({...m}),[m]),title:t._({id:"1HKt5e"}),table:_,successMessage:t._({id:"G0v/SO"})}),N=ze({url:p.stock_test_result_list,pk:D,title:t._({id:"381PhV"}),table:_,successMessage:t._({id:"xbuMqN"})}),Q=i.useCallback(a=>{u.post(v(p.stock_test_result_list),{template:a,stock_item:n,result:!0}).then(()=>{_.refreshTable(),ye({title:t._({id:"uUlW4e"}),message:t._({id:"uiR3yF"}),color:"green"})}).catch(()=>{ye({title:t._({id:"SlfejT"}),message:t._({id:"VjER3N"}),color:"red"})})},[n]),V=i.useCallback(a=>a.stock_item!=null&&a.stock_item!=n?[]:[{title:t._({id:"up/ozE"}),color:"green",icon:s.jsx(Oe,{}),hidden:!a.templateId||(a==null?void 0:a.requires_attachment)||(a==null?void 0:a.requires_value)||a.result,onClick:()=>Q(a.templateId)},{title:t._({id:"m16xKo"}),tooltip:t._({id:"VzkBcq"}),color:"green",icon:s.jsx(We,{}),hidden:!h.hasAddRole(b.stock)||!a.templateId,onClick:()=>{S(a.templateId),I.open()}},tt({tooltip:t._({id:"1HKt5e"}),hidden:!h.hasChangeRole(b.stock)||!a.template_detail,onClick:()=>{F(a.pk),E.open()}}),st({tooltip:t._({id:"381PhV"}),hidden:!h.hasDeleteRole(b.stock)||!a.template_detail,onClick:()=>{F(a.pk),N.open()}})],[h,n]),B=i.useMemo(()=>[{name:"required",label:t._({id:"TMLAx2"}),description:t._({id:"sKK8za"})},{name:"include_installed",label:t._({id:"TD72EF"}),description:t._({id:"BYeSw1"})},{name:"result",label:t._({id:"nqMwPi"}),description:t._({id:"bcwRe2"})},{name:"enabled",label:t._({id:"RxzN1M"}),description:t._({id:"+kMQXd"})}],[]),H=i.useMemo(()=>[s.jsx(Fe,{tooltip:t._({id:"VzkBcq"}),onClick:()=>{S(void 0),I.open()},hidden:!h.hasAddRole(b.stock)},"add-test-result")],[h]),O=i.useMemo(()=>{const a=[...g,{accessor:"actions",title:"  ",hidden:!1,switchable:!1,width:50,render:c=>s.jsx(at,{actions:V(c)??[]})}];return{allowMultiple:!0,content:({record:c})=>{if(!c||!c.results||c.results.length<2)return null;const r=(c==null?void 0:c.results)??[];return s.jsx(lt,{idAccessor:"test",noHeader:!0,columns:a,records:r.slice(0,-1)},c.pk)}}},[]);return s.jsxs(s.Fragment,{children:[I.modal,E.modal,N.modal,s.jsx(te,{url:v(p.stock_test_result_list),tableState:_,columns:g,props:{dataFormatter:e,enablePagination:!1,tableActions:H,tableFilters:B,rowActions:V,rowExpansion:O,params:{stock_item:n,user_detail:!0,attachment_detail:!0,template_detail:!0}}})]})}function Ht({itemId:d}){const n=Te(),u=ee("stock_tracking"),h=Lt(),_=i.useCallback(k=>{const e=(k==null?void 0:k.deltas)??{},g=[{label:t._({id:"igx8Og"}),key:"stockitem",details:e.stockitem_detail&&ge({instance:e.stockitem_detail,link:!0})},{label:t._({id:"igx8Og"}),key:"item",details:e.item_detail&&ge({instance:e.item_detail,link:!0})},{label:t._({id:"uAQUqI"}),key:"status",details:e.status&&Pe({status:e.status,type:o.stockitem})},{label:t._({id:"VbWX2u"}),key:"quantity",details:e.quantity},{label:t._({id:"hp8OtS"}),key:"added",details:e.added},{label:t._({id:"eps54V"}),key:"removed",details:e.removed},{label:t._({id:"vgP+9p"}),key:"part",details:e.part_detail&&gt({instance:e.part_detail,link:!0,navigate:n})},{label:t._({id:"wJijgU"}),key:"location",details:e.location_detail&&St({instance:e.location_detail,link:!0,navigate:n})},{label:t._({id:"YxwWvi"}),key:"buildorder",details:e.buildorder_detail&&It({instance:e.buildorder_detail,link:!0,navigate:n})},{label:t._({id:"KxySMG"}),key:"purchaseorder",details:e.purchaseorder_detail&&At({instance:e.purchaseorder_detail,link:!0,navigate:n})},{label:t._({id:"LozYBo"}),key:"salesorder",details:e.salesorder_detail&&Ct({instance:e.salesorder_detail,link:!0,navigate:n})},{label:t._({id:"Z6ve1w"}),key:"returnorder",details:e.returnorder_detail&&wt({instance:e.returnorder_detail,link:!0,navigate:n})},{label:t._({id:"876pfE"}),key:"customer",details:e.customer_detail&&vt({instance:e.customer_detail,link:!0,navigate:n})}];return s.jsx(U,{striped:!0,children:s.jsx(U.Tbody,{children:g.map(f=>f.details&&s.jsxs(U.Tr,{children:[s.jsx(U.Td,{children:s.jsx(Z,{children:f.label})}),s.jsx(U.Td,{children:f.details})]},f.key))})})},[n]),C=i.useMemo(()=>[{name:"user",label:t._({id:"7PzzBU"}),choices:h.choices,description:t._({id:"FVjW63"})}],[h]),j=i.useMemo(()=>[Be({switchable:!1}),Ee({accessor:"label"}),{accessor:"details",title:t._({id:"URmyfc"}),switchable:!1,render:_},{accessor:"notes",title:t._({id:"1DBGsz"}),sortable:!1,switchable:!0},{accessor:"user",title:t._({id:"7PzzBU"}),render:k=>k.user_detail?Me({instance:k.user_detail}):s.jsx(Z,{size:"sm",fs:"italic",children:t._({id:"L5d7xh"})})}],[]);return s.jsx(te,{tableState:u,url:v(p.stock_tracking_list),columns:j,props:{params:{item:d,user_detail:!0},enableDownload:!0,tableFilters:C}})}function Bs(){var de,ce,ue,pe,me;const{id:d}=kt(),n=Re(),u=se(),h=De(),_=i.useMemo(()=>h.isSet("STOCK_ENABLE_EXPIRY"),[h]),C=Te(),[j,k]=i.useState(!1),{instance:e,refreshInstance:g,refreshInstancePromise:f,instanceQuery:S,requestStatus:T}=Ut({endpoint:p.stock_item_list,pk:d,params:{part_detail:!0,location_detail:!0,path_detail:!0}}),m=i.useMemo(()=>{var _e,be;const l={...e},y=(e==null?void 0:e.part_detail)??{};if(l.available_stock=Math.max(0,l.quantity-l.allocated),S.isFetching)return s.jsx(K,{});const q=[{name:"part",label:t._({id:"mY+KgP"}),type:"link",model:o.part},{name:"part_detail.IPN",label:t._({id:"3wXEsN"}),type:"text",copy:!0,icon:"part",hidden:!y.IPN},{name:"status",type:"status",label:t._({id:"uAQUqI"}),model:o.stockitem},{name:"status_custom_key",type:"status",label:t._({id:"4DvUAJ"}),model:o.stockitem,icon:"status",hidden:!e.status_custom_key||e.status_custom_key==e.status},{type:"text",name:"tests",label:t._({id:"Yo+Era"}),icon:"progress",hidden:!(y!=null&&y.testable)},{type:"text",name:"updated",icon:"calendar",label:t._({id:"K7P0jz"})},{type:"text",name:"stocktake",icon:"calendar",label:t._({id:"whZ7zT"}),hidden:!e.stocktake}],W=[{type:"text",name:"quantity",label:t._({id:"VbWX2u"})},{type:"text",name:"serial",label:t._({id:"AXeJt4"}),hidden:!e.serial},{type:"text",name:"available_stock",label:t._({id:"csDS2L"}),icon:"stock"},{type:"text",name:"allocated",label:t._({id:"8oSGoC"}),icon:"tick_off",hidden:!e.allocated},{type:"text",name:"batch",label:t._({id:"Vea6Aj"}),hidden:!e.batch}],Y=[{name:"supplier_part",label:t._({id:"nne72x"}),type:"link",model:o.supplierpart,hidden:!e.supplier_part},{type:"link",name:"location",label:t._({id:"wJijgU"}),model:o.stocklocation,hidden:!e.location},{type:"link",name:"belongs_to",label:t._({id:"QPoAhl"}),model_filters:{part_detail:!0},model_formatter:A=>{var he;let ke=((he=A==null?void 0:A.part_detail)==null?void 0:he.full_name)??(A==null?void 0:A.name);return A.serial&&A.quantity==1&&(ke+=` # ${A.serial}`),ke},icon:"stock",model:o.stockitem,hidden:!e.belongs_to},{type:"link",name:"parent",icon:"sitemap",label:t._({id:"0o0T0n"}),model:o.stockitem,hidden:!e.parent,model_formatter:A=>t._({id:"94QKKW"})},{type:"link",name:"consumed_by",label:t._({id:"H00rnl"}),model:o.build,hidden:!e.consumed_by,icon:"build",model_field:"reference"},{type:"link",name:"build",label:t._({id:"YxwWvi"}),model:o.build,hidden:!e.build,model_field:"reference"},{type:"link",name:"purchase_order",label:t._({id:"KxySMG"}),model:o.purchaseorder,hidden:!e.purchase_order,icon:"purchase_orders",model_field:"reference"},{type:"link",name:"sales_order",label:t._({id:"LozYBo"}),model:o.salesorder,hidden:!e.sales_order,icon:"sales_orders",model_field:"reference"},{type:"link",name:"customer",label:t._({id:"876pfE"}),model:o.company,hidden:!e.customer}],G=[{type:"date",name:"expiry_date",label:t._({id:"uaSvqt"}),hidden:!_||!e.expiry_date,icon:"calendar"},{type:"text",name:"purchase_price",label:t._({id:"vWelsN"}),icon:"currency",hidden:!e.purchase_price,value_formatter:()=>Ie(e.purchase_price,{currency:e.purchase_price_currency})},{type:"text",name:"stock_value",label:t._({id:"g9RfVq"}),icon:"currency",hidden:!e.purchase_price||e.quantity==1||e.quantity==0,value_formatter:()=>Ie(e.purchase_price,{currency:e.purchase_price_currency,multiplier:e.quantity})},{type:"text",name:"packaging",icon:"part",label:t._({id:"pD/Ew0"}),hidden:!e.packaging}];return s.jsxs(ot,{children:[s.jsxs(X,{children:[s.jsx(X.Col,{span:4,children:s.jsx(rt,{appRole:b.part,apiPath:p.part_list,src:((_e=e.part_detail)==null?void 0:_e.image)??((be=e==null?void 0:e.part_detail)==null?void 0:be.thumbnail),pk:e.part})}),s.jsx(X.Col,{span:8,children:s.jsx(J,{fields:q,item:l})})]}),s.jsx(J,{fields:W,item:l}),s.jsx(J,{fields:Y,item:l}),s.jsx(J,{fields:G,item:l})]})},[e,S.isFetching,_]),I=i.useMemo(()=>{var l;return((l=e==null?void 0:e.part_detail)==null?void 0:l.component)&&!(e!=null&&e.sales_order)&&!(e!=null&&e.belongs_to)},[e]),D=i.useMemo(()=>{var l;return(l=e==null?void 0:e.part_detail)==null?void 0:l.salable},[e]),F=we({queryKey:["tracked-bom-item",e.pk,e.part],queryFn:()=>{var l;return!e.pk||!e.part||!((l=e.part_detail)!=null&&l.assembly)?!1:n.get(v(p.bom_list),{params:{part:e.part,sub_part_trackable:!0,limit:1}}).then(y=>y.status==200?y.data.count>0:null).catch(()=>null)}}),E=i.useMemo(()=>{var l;return e!=null&&e.installed_items?!0:F.data!=null?F.data:(l=e==null?void 0:e.part_detail)==null?void 0:l.assembly},[F,e]),N=i.useMemo(()=>{var l;return[{name:"details",label:t._({id:"hBG+yp"}),icon:s.jsx(ve,{}),content:m},{name:"tracking",label:t._({id:"IdrYoA"}),icon:s.jsx(Ye,{}),content:e.pk?s.jsx(Ht,{itemId:e.pk}):s.jsx(K,{})},{name:"allocations",label:t._({id:"KwhnxF"}),icon:s.jsx(Ge,{}),hidden:!e.in_stock||!D&&!I,content:s.jsxs(P,{multiple:!0,defaultValue:["buildAllocations","salesAllocations"],children:[I&&s.jsxs(P.Item,{value:"buildAllocations",children:[s.jsx(P.Control,{children:s.jsx(je,{size:"lg",children:t._({id:"KCpl4N"})})}),s.jsx(P.Panel,{children:s.jsx(Kt,{stockId:e.pk,modelField:"build",modelTarget:o.build,showBuildInfo:!0})})]},"buildAllocations"),D&&s.jsxs(P.Item,{value:"salesAllocations",children:[s.jsx(P.Control,{children:s.jsx(je,{size:"lg",children:t._({id:"DaWMWw"})})}),s.jsx(P.Panel,{children:s.jsx(Nt,{stockId:e.pk,modelField:"order",modelTarget:o.salesorder,showOrderInfo:!0})})]},"salesAllocations")]})},{name:"testdata",label:t._({id:"dljGeD"}),icon:s.jsx(Le,{}),hidden:!((l=e==null?void 0:e.part_detail)!=null&&l.testable),content:e!=null&&e.pk?s.jsx(Qt,{itemId:e.pk,partId:e.part}):s.jsx(K,{})},{name:"installed_items",label:t._({id:"xnskHi"}),icon:s.jsx(Je,{}),hidden:!E,content:s.jsx(Jt,{stockItem:e})},{name:"child_items",label:t._({id:"K4v96J"}),icon:s.jsx(Qe,{}),hidden:((e==null?void 0:e.child_items)??0)==0,content:e!=null&&e.pk?s.jsx(Rt,{tableName:"child-stock",params:{ancestor:e.pk}}):s.jsx(K,{})},ft({model_type:o.stockitem,model_id:e.pk}),dt({model_type:o.stockitem,model_id:e.pk})]},[D,I,E,e,d,u]),Q=i.useMemo(()=>[{name:t._({id:"blbbPS"}),url:"/stock"},...(e.location_path??[]).map(l=>({name:l.name,url:$(o.stocklocation,l.pk)}))],[e]),V=Ce({create:!1,stockItem:e,partId:e.part}),B=qe({url:p.stock_item_list,pk:e.pk,title:t._({id:"gQgYNs"}),fields:V,onFormSuccess:g}),H=Ce({create:!0}),O=z({url:p.stock_item_list,title:t._({id:"bJLEQT"}),fields:H,initialData:{...e},follow:!0,modelType:o.stockitem}),a=i.useMemo(()=>{},[e]),c=ze({url:p.stock_item_list,pk:e.pk,title:t._({id:"BJoa27"}),preFormContent:a,onFormSuccess:()=>{C($(o.part,e.part))}}),r=i.useMemo(()=>({items:[e],model:o.stockitem,refresh:g,filters:{in_stock:!0}}),[e]),x=Dt(r),M=Ft(r),ae=qt(r),le=zt(r),ie=Et(r),Ue=Bt({partId:e.part,trackable:(de=e.part_detail)==null?void 0:de.trackable}),oe=z({url:p.stock_serialize,pk:e.pk,title:t._({id:"ETKLHa"}),fields:Ue,initialData:{quantity:e.quantity,destination:e.location??((ce=e.part_detail)==null?void 0:ce.default_location)},onFormSuccess:()=>{const l=e.part;f().catch(()=>{C($(o.part,l))})},successMessage:t._({id:"Hkw/xj"})}),ne=z({url:p.stock_return,pk:e.pk,title:t._({id:"FY3xEt"}),preFormContent:s.jsx(He,{color:"blue",children:t._({id:"xRHE+Q"})}),fields:{location:{},status:{},notes:{}},initialData:{location:e.location??((ue=e.part_detail)==null?void 0:ue.default_location),status:e.status_custom_key??e.status},successMessage:t._({id:"M6A9fW"}),onFormSuccess:()=>{g()}}),re=Tt({parts:e.part_detail?[e.part_detail]:[]}),Ke=i.useMemo(()=>{var W,Y,G;const l=u.hasChangeRole(b.stock)&&!e.sales_order&&!e.belongs_to&&!e.customer&&!e.consumed_by&&!e.is_building,y=e.serial,q=y!=null&&y!=null&&y!=""&&e.quantity==1;return[s.jsx(et,{model:o.stockitem,id:e.pk}),s.jsx(jt,{stockId:e.pk}),s.jsx(ct,{model:o.stockitem,pk:e.pk,hash:e==null?void 0:e.barcode_hash,perm:u.hasChangeRole(b.stock)}),s.jsx(it,{modelType:o.stockitem,items:[e.pk],enableReports:!0,enableLabels:!0}),s.jsx(ut,{tooltip:t._({id:"ClJC3x"}),icon:s.jsx(Xe,{}),actions:[{name:t._({id:"wBMjJ2"}),tooltip:t._({id:"rb0Klh"}),hidden:q||!l,icon:s.jsx(R,{icon:"stocktake",iconProps:{color:"blue"}}),onClick:()=>{e.pk&&x.open()}},{name:t._({id:"m16xKo"}),tooltip:t._({id:"smUxso"}),hidden:q||!l,icon:s.jsx(R,{icon:"add",iconProps:{color:"green"}}),onClick:()=>{e.pk&&M.open()}},{name:t._({id:"t/YqKh"}),tooltip:t._({id:"dxvf6V"}),hidden:q||!l||e.quantity<=0,icon:s.jsx(R,{icon:"remove",iconProps:{color:"red"}}),onClick:()=>{e.pk&&ae.open()}},{name:t._({id:"zPGNJm"}),tooltip:t._({id:"9efe+k"}),hidden:!l,icon:s.jsx(R,{icon:"transfer",iconProps:{color:"blue"}}),onClick:()=>{e.pk&&le.open()}},{name:t._({id:"Wlr+mY"}),tooltip:t._({id:"Vmnyam"}),hidden:!l||q||((W=e==null?void 0:e.part_detail)==null?void 0:W.trackable)!=!0,icon:s.jsx(R,{icon:"serial",iconProps:{color:"blue"}}),onClick:()=>{oe.open()}},{name:t._({id:"UYUgdb"}),tooltip:t._({id:"cUzrZK"}),hidden:!u.hasAddRole(b.purchase_order)||!((Y=e.part_detail)!=null&&Y.active)||!((G=e.part_detail)!=null&&G.purchaseable),icon:s.jsx($e,{color:"blue"}),onClick:()=>{re.openWizard()}},{name:t._({id:"vUOn9d"}),tooltip:t._({id:"CwkTmH"}),hidden:!e.customer,icon:s.jsx(R,{icon:"return_orders",iconProps:{color:"blue"}}),onClick:()=>{e.pk&&ne.open()}},{name:t._({id:"7J5Eno"}),tooltip:t._({id:"Ch8pZV"}),hidden:!!e.customer,icon:s.jsx(R,{icon:"customer",iconProps:{color:"blue"}}),onClick:()=>{e.pk&&ie.open()}}]}),s.jsx(pt,{tooltip:t._({id:"oPF3fX"}),actions:[mt({hidden:!u.hasAddRole(b.stock),onClick:()=>O.open()}),_t({hidden:!u.hasChangeRole(b.stock),onClick:()=>B.open()}),bt({hidden:!u.hasDeleteRole(b.stock),onClick:()=>c.open()})]})]},[d,e,u]),Ne=i.useMemo(()=>{let l=((e==null?void 0:e.quantity)??0)-((e==null?void 0:e.allocated)??0);return l=Math.max(0,l),S.isLoading?[]:[s.jsx(w,{color:"yellow",label:t._({id:"BE5Q6v"}),visible:e.is_building}),s.jsx(w,{color:"blue",label:`${t._({id:"AXeJt4"})}: ${e.serial}`,visible:!!e.serial},"serial"),s.jsx(w,{color:"blue",label:`${t._({id:"VbWX2u"})}: ${e.quantity}`,visible:!e.serial},"quantity"),s.jsx(w,{color:"yellow",label:`${t._({id:"csDS2L"})}: ${l}`,visible:e.in_stock&&!e.serial&&l!=e.quantity},"available"),s.jsx(w,{color:"blue",label:`${t._({id:"Vea6Aj"})}: ${e.batch}`,visible:!!e.batch},"batch"),s.jsx(Pe,{status:e.status_custom_key||e.status,type:o.stockitem,options:{size:"lg"}},"status"),s.jsx(w,{color:"yellow",label:t._({id:"1ba70W"}),visible:_&&e.stale&&!e.expired},"stale"),s.jsx(w,{color:"orange",label:t._({id:"M1RnFv"}),visible:_&&e.expired},"expired"),s.jsx(w,{color:"red",label:t._({id:"jqzUyM"}),visible:e.in_stock==!1},"unavailable")]},[e,S,_]);return s.jsx(nt,{requiredRole:b.stock,status:T,loading:S.isFetching,children:s.jsxs(Ze,{children:[u.hasViewRole(b.stock_location)&&s.jsx(ht,{title:t._({id:"1eBWAw"}),modelType:o.stocklocation,endpoint:p.stock_location_tree,opened:j,onClose:()=>k(!1),selectedId:e==null?void 0:e.location}),s.jsx(xt,{title:t._({id:"igx8Og"}),subtitle:(pe=e.part_detail)==null?void 0:pe.full_name,imageUrl:(me=e.part_detail)==null?void 0:me.thumbnail,editAction:B.open,editEnabled:u.hasChangePermission(o.stockitem),badges:Ne,breadcrumbs:u.hasViewRole(b.stock_location)?Q:void 0,breadcrumbAction:()=>{k(!0)},actions:Ke}),s.jsx(yt,{pageKey:"stockitem",panels:N,model:o.stockitem,id:e.pk,instance:e}),B.modal,O.modal,c.modal,x.modal,M.modal,ae.modal,le.modal,oe.modal,ne.modal,ie.modal,re.wizard]})})}export{Bs as default};
