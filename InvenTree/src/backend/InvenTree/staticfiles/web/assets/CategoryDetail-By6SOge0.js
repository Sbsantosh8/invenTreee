import{bA as H,r,i as t,j as a,d2 as J,G as v,by as V,aI as X,ci as $,m as z,Z as ee,bk as te,e9 as ae,a1 as se,ae as re,S as oe,bF as ie}from"./vendor-9x6k4T-r.js";import{A as ne}from"./AdminButton-Dr56qn7X.js";import{I as le,D as G,a as ce}from"./InstanceDetail-B4p22K57.js";import{O as de,E as pe,D as me}from"./ActionDropdown-DlGcqXhK.js";import{A as S}from"./ApiIcon-BBFuOj6_.js";import{N as ue}from"./NavigationTree-Dl2ZR6jN.js";import{P as _e}from"./PageDetail-DJvgu_vJ.js";import{P as fe}from"./PanelGroup-BCG3mCoU.js";import{c as E,A as b,U as w,e as D,f as R,m as f}from"./index-Bd_yPD7D.js";import{u as be,p as N}from"./PartForms-Ds82cVAL.js";import{u as Z,a as K,A as xe,b as ge}from"./UseForm-C7xHtQGh.js";import{u as ye}from"./UseInstance-Cb46b_w1.js";import{Y as L}from"./YesNoButton-BsHbI51V.js";import{u as he}from"./DesktopAppView-D7dqNL6j.js";import{d as je}from"./formatters-MBbtNL9a.js";import{c as ke,n as Ce}from"./navigation-BUwul1Ze.js";import{u as U,I as B,R as Pe}from"./InvenTreeTable-KDc6oHjF.js";import{a as Ie,D as Q,g as ve}from"./ColumnRenderers-CTwRHGdM.js";import{e as W,C as we}from"./ThemeContext-DRe09WSE.js";import{P as Fe}from"./PartTable-CKna9egO.js";import{S as Te}from"./StockItemTable-C1bOB_vf.js";import"./Instance-ZaRjKoLj.js";import"./GenericErrorPage-C2ho8aty.js";import"./NotFound-o4Sp_RYV.js";import"./PermissionDenied-Di_W_uvf.js";import"./PageTitle-D--W0kLm.js";import"./RemoteComponent-C0S0OuAi.js";import"./dayjs.min-DUmzidR_.js";import"./OrderPartsWizard-BpRHlLRb.js";import"./CompanyForms-BzJpK2Vu.js";import"./PurchaseOrderForms-CTnFU4km.js";import"./RemoveRowButton-PzDbXrvR.js";import"./UseGenerator-BZWzvoyo.js";import"./UsePlaceholder-C_lBT7aw.js";function Ae({record:m,template:s,canEdit:c}){const{hovered:u,ref:y}=J(),i=r.useMemo(()=>{var l;return(l=m.parameters)==null?void 0:l.find(j=>j.template==s.pk)},[m.parameters,s]),e=[],h=r.useMemo(()=>{let l=i==null?void 0:i.data;return s!=null&&s.checkbox&&l!=null&&(l=a.jsx(L,{value:i.data})),l},[i,s]);if(s.units&&i&&i.data_numeric&&i.data_numeric!=i.data){const l=je(i.data_numeric,{digits:15});e.push(`${l} [${s.units}]`)}return u&&c&&e.push(t._({id:"cwMTjO"})),a.jsx("div",{children:a.jsx(v,{grow:!0,ref:y,justify:"space-between",children:a.jsx(v,{grow:!0,children:a.jsx(ve,{value:h??"-",extra:e,icon:u&&c?"edit":"info",title:s.name})})})})}function Se({categoryId:m}){const s=he(),c=U("parametric-parts"),u=E(),y=W(),i=H({queryKey:["category-parameters",m],queryFn:async()=>s.get(D(b.part_parameter_template_list),{params:{category:m}}).then(d=>d.data).catch(d=>[]),refetchOnMount:!0}),[e,h]=r.useState(0),[l,j]=r.useState(0),[C,k]=r.useState(0),x=be({editTemplate:!1}),n=Z({url:b.part_parameter_list,title:t._({id:"iwRvX8"}),fields:r.useMemo(()=>({...x}),[x]),focus:"data",onFormSuccess:d=>{T(e,d)},initialData:{part:e,template:l}}),P=K({url:b.part_parameter_list,title:t._({id:"ZqLOh/"}),pk:C,fields:r.useMemo(()=>({...x}),[x]),focus:"data",onFormSuccess:d=>{T(e,d)}}),T=r.useCallback((d,o)=>{const _=c.records,p=_.findIndex(I=>I.pk==d);if(p<0){c.refreshTable();return}const F=_[p].parameters.findIndex(I=>I.pk==o.pk);F<0?_[p].parameters.push(o):_[p].parameters[F]=o,c.updateRecord(_[p])},[c.updateRecord]),A=r.useMemo(()=>(i.data??[]).map(o=>{let _=o.name;return o.units&&(_+=` [${o.units}]`),{accessor:`parameter_${o.pk}`,title:_,sortable:!0,extra:{template:o.pk},render:p=>a.jsx(Ae,{record:p,template:o,canEdit:u.hasChangeRole(w.part)})}}),[u,i.data]),g=r.useCallback((d,o)=>{var p;j(d),h(o.pk);const _=(p=o.parameters)==null?void 0:p.find(F=>F.template==d);_?(k(_.pk),P.open()):n.open()},[]),M=r.useMemo(()=>[{name:"active",label:t._({id:"F6pfE9"}),description:t._({id:"xqUGVc"})},{name:"locked",label:t._({id:"G2fuEb"}),description:t._({id:"tB/dWJ"})},{name:"assembly",label:t._({id:"WL36Yh"}),description:t._({id:"IxF0Eq"})}],[]),Y=r.useMemo(()=>[...[{accessor:"name",sortable:!0,switchable:!1,noWrap:!0,render:o=>Ie({part:o})},Q({}),{accessor:"IPN",sortable:!0},{accessor:"total_in_stock",sortable:!0}],...A],[A]);return a.jsxs(a.Fragment,{children:[n.modal,P.modal,a.jsx(B,{url:D(b.part_list),tableState:c,columns:Y,props:{enableDownload:!1,tableFilters:M,params:{category:m,cascade:!0,category_detail:!0,parameters:!0},onCellClick:({event:d,record:o,index:_,column:p,columnIndex:F})=>{var I,O;if(ke(d),(O=(I=p==null?void 0:p.accessor)==null?void 0:I.toString())!=null&&O.startsWith("parameter_"))g(p.extra.template,o);else if(o!=null&&o.pk){const q=R(f.part,o.pk);Ce(q,y,d)}}}})]})}function Me({parentId:m}){const s=U("partcategory"),c=E(),u=r.useMemo(()=>[{accessor:"name",sortable:!0,switchable:!1,render:n=>a.jsxs(v,{gap:"xs",wrap:"nowrap",justify:"space-between",children:[a.jsxs(v,{gap:"xs",wrap:"nowrap",children:[n.icon&&a.jsx(S,{name:n.icon}),n.name]}),a.jsx(v,{gap:"xs",justify:"flex-end",wrap:"nowrap",children:n.starred&&a.jsx(V,{label:t._({id:"mUyvRx"}),children:a.jsx(X,{color:"green",size:16})})})]})},Q({}),{accessor:"pathstring",sortable:!1},{accessor:"structural",sortable:!0,render:n=>a.jsx(L,{value:n.structural})},{accessor:"part_count",sortable:!0}],[]),y=r.useMemo(()=>[{name:"cascade",label:t._({id:"NgZniC"}),description:t._({id:"Tt3/Pp"})},{name:"structural",label:t._({id:"PRKZBP"}),description:t._({id:"kHkg2b"})},{name:"starred",label:t._({id:"7VIaU3"}),description:t._({id:"mcDc03"})}],[]),i=N({create:!0}),e=Z({url:b.category_list,title:t._({id:"sIMwJx"}),fields:i,focus:"name",initialData:{parent:m},follow:!0,modelType:f.partcategory,table:s}),[h,l]=r.useState(-1),j=N({create:!1}),C=K({url:b.category_list,pk:h,title:t._({id:"7fjpj0"}),fields:j,onFormSuccess:n=>s.updateRecord(n)}),k=r.useMemo(()=>{const n=c.hasAddRole(w.part_category);return[a.jsx(xe,{tooltip:t._({id:"5LuNgu"}),onClick:()=>e.open(),hidden:!n},"add-part-category")]},[c]),x=r.useCallback(n=>{const P=c.hasChangeRole(w.part_category);return[Pe({hidden:!P,onClick:()=>{l(n.pk),C.open()}})]},[c]);return a.jsxs(a.Fragment,{children:[e.modal,C.modal,a.jsx(B,{url:D(b.category_list),tableState:s,columns:u,props:{enableDownload:!0,params:{parent:m,top_level:m===void 0?!0:void 0},tableFilters:y,tableActions:k,rowActions:x,modelType:f.partcategory}})]})}function ut(){const{id:m}=we(),s=r.useMemo(()=>Number.isNaN(Number.parseInt(m||""))?void 0:m,[m]),c=W(),u=E(),[y,i]=r.useState(!1),{instance:e,refreshInstance:h,instanceQuery:l,requestStatus:j}=ye({endpoint:b.category_list,hasPrimaryKey:!0,pk:s,params:{path_detail:!0}}),C=r.useMemo(()=>{if(s&&l.isFetching)return a.jsx($,{});const g=[{type:"text",name:"name",label:t._({id:"6YtxFj"}),copy:!0,value_formatter:()=>a.jsxs(v,{gap:"xs",children:[e.icon&&a.jsx(S,{name:e.icon}),e.name]})},{type:"text",name:"pathstring",label:t._({id:"I6gXOa"}),icon:"sitemap",copy:!0,hidden:!s},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"link",name:"parent",model_field:"name",icon:"location",label:t._({id:"o8hZ41"}),model:f.partcategory,hidden:!(e!=null&&e.parent)},{type:"boolean",name:"starred",icon:"notification",label:t._({id:"7VIaU3"})}],M=[{type:"text",name:"part_count",label:t._({id:"pmRbKZ"}),icon:"part",value_formatter:()=>(e==null?void 0:e.part_count)||"0"},{type:"text",name:"subcategories",label:t._({id:"7lonqg"}),icon:"sitemap",hidden:!(e!=null&&e.subcategories)},{type:"boolean",name:"structural",label:t._({id:"PRKZBP"}),icon:"sitemap"},{type:"link",name:"parent_default_location",label:t._({id:"XLVNTv"}),model:f.stocklocation,hidden:!e.parent_default_location||e.default_location},{type:"link",name:"default_location",label:t._({id:"QC5Msb"}),model:f.stocklocation,hidden:!e.default_location}];return a.jsxs(le,{children:[s&&(e!=null&&e.pk)?a.jsx(G,{item:e,fields:g}):a.jsx(z,{children:t._({id:"PFKWrQ"})}),s&&(e==null?void 0:e.pk)&&a.jsx(G,{item:e,fields:M})]})},[e,l]),k=K({url:b.category_list,pk:s,title:t._({id:"7fjpj0"}),fields:N({}),onFormSuccess:h}),x=r.useMemo(()=>[{value:0,display_name:t._({id:"y6iD6w"})},{value:1,display_name:t._({id:"lzGbCT"})}],[]),n=ge({url:b.category_list,pk:s,title:t._({id:"2tjyh5"}),fields:{delete_parts:{label:t._({id:"PJYQQn"}),description:t._({id:"ZqK0DP"}),choices:x,field_type:"choice"},delete_child_categories:{label:t._({id:"QgH9YK"}),description:t._({id:"ISGGrw"}),choices:x,field_type:"choice"}},onFormSuccess:()=>{e.parent?c(R(f.partcategory,e.parent)):c("/part/")}}),P=r.useMemo(()=>[a.jsx(ne,{model:f.partcategory,id:e.pk},"admin"),a.jsx(de,{tooltip:t._({id:"O/o81A"}),actions:[pe({hidden:!s||!u.hasChangeRole(w.part_category),tooltip:t._({id:"7fjpj0"}),onClick:()=>k.open()}),me({hidden:!s||!u.hasDeleteRole(w.part_category),tooltip:t._({id:"2tjyh5"}),onClick:()=>n.open()})]},"category-actions")],[s,u,e.pk]),T=r.useMemo(()=>[{name:"details",label:t._({id:"wp9B4i"}),icon:a.jsx(ee,{}),content:C},{name:"subcategories",label:t._({id:"7lonqg"}),icon:a.jsx(te,{}),content:a.jsx(Me,{parentId:s})},{name:"parts",label:t._({id:"pmRbKZ"}),icon:a.jsx(ae,{}),content:a.jsx(Fe,{props:{params:{category:s}}})},{name:"stockitem",label:t._({id:"Jbck4N"}),icon:a.jsx(se,{}),hidden:!s,content:a.jsx(Te,{params:{category:s},allowAdd:!1,tableName:"category-stockitems"})},{name:"parameters",label:t._({id:"TxrNvj"}),icon:a.jsx(re,{}),content:a.jsx(Se,{categoryId:s})}],[e,s]),A=r.useMemo(()=>[{name:t._({id:"pmRbKZ"}),url:"/part"},...(e.path??[]).map(g=>({name:g.name,url:R(f.partcategory,g.pk),icon:g.icon?a.jsx(S,{name:g.icon}):void 0}))],[e]);return a.jsxs(a.Fragment,{children:[k.modal,n.modal,a.jsx(ce,{status:j,loading:s?l.isFetching:!1,requiredRole:w.part_category,children:a.jsxs(oe,{gap:"xs",children:[a.jsx(ie,{visible:l.isFetching}),a.jsx(ue,{modelType:f.partcategory,title:t._({id:"2GkbLI"}),endpoint:b.category_tree,opened:y,onClose:()=>{i(!1)},selectedId:e==null?void 0:e.pk}),a.jsx(_e,{title:t._({id:"QXANxH"}),subtitle:e==null?void 0:e.name,icon:(e==null?void 0:e.icon)&&a.jsx(S,{name:e==null?void 0:e.icon}),breadcrumbs:A,breadcrumbAction:()=>{i(!0)},actions:P,editAction:k.open,editEnabled:u.hasChangePermission(f.partcategory)}),a.jsx(fe,{pageKey:"partcategory",panels:T,model:f.partcategory,instance:e,id:e.pk??null})]})})]})}export{ut as default};
