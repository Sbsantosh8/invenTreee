import{j as e,r as l,bG as C,i as t,d as W,m as _,bI as r,S as u,bW as f,G as z,I as S,aD as M,ax as E,az as G,Z as N,s as X,fg as Z,by as k,fh as H}from"./vendor-9x6k4T-r.js";import{a as D,u as J,b as U,c as w}from"./UseForm-C7xHtQGh.js";import{Y as Q}from"./YesNoButton-BsHbI51V.js";import{D as q}from"./DetailDrawer-DT_CXWKz.js";import{A as c,c as $,d as I,e as K}from"./index-Bd_yPD7D.js";import{u as ee}from"./UseInstance-Cb46b_w1.js";import{I as d}from"./InfoItem-CPavuCqD.js";import{C as te,S as P,e as ie}from"./ThemeContext-DRe09WSE.js";import{P as se}from"./SettingList-B-7Q1HIu.js";import{u as ae,R as le}from"./RemoteComponent-C0S0OuAi.js";import{u as oe}from"./DesktopAppView-D7dqNL6j.js";import{u as re,I as de}from"./InvenTreeTable-KDc6oHjF.js";import"./dayjs.min-DUmzidR_.js";import"./ApiIcon-BBFuOj6_.js";import"./Instance-ZaRjKoLj.js";import"./navigation-BUwul1Ze.js";import"./ActionDropdown-DlGcqXhK.js";function ne({pluginAdmin:a}){const i=ae();return e.jsx(le,{source:a.source,defaultFunctionName:"renderPluginSettings",context:{...i,context:a.context}})}function me({pluginKey:a,pluginInstance:i}){const{id:j}=te(),n=l.useMemo(()=>a||j||"",[a,j]),{instance:o}=ee({endpoint:c.plugin_admin,pathParams:{key:n},defaultValue:{},hasPrimaryKey:!1,refetchOnMount:!0}),p=l.useMemo(()=>{var m;return!!((m=i==null?void 0:i.mixins)!=null&&m.settings)},[i]);return i.active?e.jsxs(r,{defaultValue:["plugin-details","plugin-settings"],multiple:!0,children:[e.jsxs(r.Item,{value:"plugin-details",children:[e.jsx(r.Control,{children:e.jsx(P,{size:"lg",children:t._({id:"5HArLW"})})}),e.jsx(r.Panel,{children:e.jsxs(u,{gap:"xs",children:[e.jsx(f,{withBorder:!0,children:e.jsx(u,{gap:"md",children:e.jsxs(u,{pos:"relative",gap:"xs",children:[e.jsx(d,{type:"text",name:t._({id:"6YtxFj"}),value:i==null?void 0:i.name}),e.jsx(d,{type:"text",name:t._({id:"Nu4oKW"}),value:i==null?void 0:i.meta.description}),e.jsx(d,{type:"text",name:t._({id:"VbeIOx"}),value:i==null?void 0:i.meta.author}),e.jsx(d,{type:"text",name:t._({id:"mYGY3B"}),value:i==null?void 0:i.meta.pub_date}),e.jsx(d,{type:"text",name:t._({id:"eE0JZ4"}),value:i==null?void 0:i.meta.version}),e.jsx(d,{type:"boolean",name:t._({id:"F6pfE9"}),value:i==null?void 0:i.active})]})})}),e.jsx(f,{withBorder:!0,children:e.jsx(u,{gap:"md",children:e.jsxs(u,{pos:"relative",gap:"xs",children:[(i==null?void 0:i.is_package)&&e.jsx(d,{type:"text",name:t._({id:"/L+cAM"}),value:i==null?void 0:i.package_name}),e.jsx(d,{type:"text",name:t._({id:"AJd5vK"}),value:i==null?void 0:i.meta.package_path}),e.jsx(d,{type:"boolean",name:t._({id:"++LBSt"}),value:i==null?void 0:i.is_builtin}),e.jsx(d,{type:"boolean",name:t._({id:"mGYa19"}),value:i==null?void 0:i.is_package})]})})})]})})]}),p&&e.jsxs(r.Item,{value:"plugin-settings",children:[e.jsx(r.Control,{children:e.jsx(P,{size:"lg",children:t._({id:"eKHY3W"})})}),e.jsx(r.Panel,{children:e.jsx(f,{withBorder:!0,children:e.jsx(se,{pluginKey:n})})})]}),(o==null?void 0:o.source)&&e.jsxs(r.Item,{value:"plugin-custom",children:[e.jsx(r.Control,{children:e.jsx(P,{size:"lg",children:t._({id:"BFm1Jm"})})}),e.jsx(r.Panel,{children:e.jsx(f,{withBorder:!0,children:e.jsx(ne,{pluginAdmin:o})})})]})]}):e.jsx(C,{color:"red",title:t._({id:"nNlKYH"}),icon:e.jsx(W,{}),children:e.jsx(_,{children:t._({id:"xwdvWr"})})})}function ce({plugin:a}){return a!=null&&a.is_installed?a!=null&&a.active?e.jsx(k,{label:t._({id:"QqLLp2"}),children:e.jsx(S,{color:"green"})}):e.jsx(k,{label:t._({id:"s99Mc1"}),children:e.jsx(M,{color:"red"})}):e.jsx(k,{label:t._({id:"LtEW/l"}),children:e.jsx(H,{})})}function Fe(){const a=oe(),i=re("plugin"),j=ie(),n=$(),{server:o}=I(),p=l.useMemo(()=>[{accessor:"name",title:t._({id:"fOuPPd"}),sortable:!0,render:s=>{if(s)return e.jsxs(z,{justify:"left",children:[e.jsx(ce,{plugin:s}),e.jsx(_,{children:s.name})]})}},{accessor:"active",sortable:!0,title:t._({id:"F6pfE9"}),render:s=>e.jsx(Q,{value:s.active})},{accessor:"meta.description",title:t._({id:"Nu4oKW"}),sortable:!1,render:s=>s.active?s==null?void 0:s.meta.description:e.jsx(_,{style:{fontStyle:"italic"},size:"sm",children:t._({id:"9YdyZU"})})},{accessor:"meta.version",title:t._({id:"eE0JZ4"}),sortable:!1,render:s=>s==null?void 0:s.meta.version},{accessor:"meta.author",title:"Author",sortable:!1}],[]),[m,L]=l.useState({}),[b,h]=l.useState(""),[x,A]=l.useState(!1),R=l.useMemo(()=>e.jsx(u,{gap:"xs",children:e.jsx(C,{color:x?"green":"red",icon:e.jsx(S,{}),title:x?t._({id:"fLe7w+"}):t._({id:"oBCe/M"}),children:e.jsx(_,{children:x?t._({id:"th4roR"}):t._({id:"WPCUXx"})})})}),[x]),Y=l.useCallback(s=>!n.isSuperuser()||!o.plugins_enabled?[]:[{hidden:s.is_builtin!=!1||s.active!=!0,title:t._({id:"5y3O+A"}),color:"red",icon:e.jsx(M,{}),onClick:()=>{h(s.key),A(!1),v.open()}},{hidden:s.is_builtin!=!1||!s.is_installed||s.active!=!1,title:t._({id:"FQBaXG"}),tooltip:t._({id:"RqdYGI"}),color:"green",icon:e.jsx(S,{}),onClick:()=>{h(s.key),A(!0),v.open()}},{hidden:!s.active||!s.is_package||!s.package_name,title:t._({id:"EkH9pt"}),tooltip:t._({id:"R7mVjI"}),color:"blue",icon:e.jsx(E,{}),onClick:()=>{T(s.package_name),y.open()}},{hidden:!n.isSuperuser()||s.active||s.is_builtin||s.is_sample||!s.is_installed||!s.is_package,title:t._({id:"fo0VXg"}),tooltip:t._({id:"ll8AEP"}),color:"red",icon:e.jsx(M,{}),onClick:()=>{h(s.key),F.open()}},{hidden:s.active||s.is_builtin||s.is_sample||s.is_installed||!n.isSuperuser(),title:t._({id:"cnGeoo"}),tooltip:t._({id:"yX/BXa"}),color:"red",icon:e.jsx(G,{}),onClick:()=>{h(s.key),B.open()}}],[n,o]),[g,T]=l.useState(""),v=D({title:t._({id:"2RHgaV"}),url:c.plugin_activate,pathParams:{key:b},preFormContent:R,fetchInitialData:!1,method:"POST",successMessage:x?t._({id:"VAuM5b"}):t._({id:"ysKQPq"}),fields:{active:{hidden:!0}},initialData:{active:x},table:i}),y=J({title:t._({id:"R7k68Z"}),url:c.plugin_install,timeout:3e4,fields:{packagename:{},url:{},version:{},confirm:{}},initialData:{packagename:g},closeOnClickOutside:!1,submitText:t._({id:"TKQ7K+"}),successMessage:t._({id:"MiYlP5"}),table:i}),F=D({title:t._({id:"mXzRzO"}),url:c.plugin_uninstall,pathParams:{key:b},fetchInitialData:!1,timeout:3e4,fields:{delete_config:{}},preFormContent:e.jsx(C,{color:"red",icon:e.jsx(N,{}),title:t._({id:"6onEou"}),children:e.jsxs(u,{gap:"xs",children:[e.jsx(_,{children:t._({id:"nh4MTY"})}),e.jsx(_,{children:t._({id:"U99rVM"})})]})}),successMessage:t._({id:"MAZU/W"}),table:i}),B=U({url:c.plugin_list,pk:b,fetchInitialData:!1,title:t._({id:"nud26y"}),preFormWarning:t._({id:"vb5uIh"}),table:i}),O=l.useCallback(()=>{a.post(K(c.plugin_reload),{full_reload:!0,force_reload:!0,collect_plugins:!0}).then(()=>{X({title:t._({id:"Bs76+T"}),message:t._({id:"js1VzJ"}),color:"green"}),i.refreshTable()})},[]),V=l.useMemo(()=>!n.isSuperuser()||!o.plugins_enabled?[]:[e.jsx(w,{color:"green",icon:e.jsx(E,{}),tooltip:t._({id:"2VWTDu"}),onClick:O},"reload"),e.jsx(w,{color:"green",icon:e.jsx(Z,{}),tooltip:t._({id:"0O/OZv"}),onClick:()=>{T(""),y.open()},disabled:o.plugins_install_disabled||!1},"install")],[n,o]);return e.jsxs(e.Fragment,{children:[y.modal,F.modal,B.modal,v.modal,e.jsx(q,{title:`${t._({id:"NCjc4L"})} - ${m==null?void 0:m.name}`,size:"65%",renderContent:s=>{if(s)return e.jsx(me,{pluginKey:s,pluginInstance:m})}}),e.jsx(de,{url:K(c.plugin_list),tableState:i,columns:p,props:{enableDownload:!1,rowActions:Y,onRowClick:s=>{L(s),j(`${s.key}/`)},tableActions:V,tableFilters:[{name:"active",label:t._({id:"F6pfE9"}),type:"boolean"},{name:"builtin",label:t._({id:"++LBSt"}),type:"boolean"},{name:"sample",label:t._({id:"LcJmOR"}),type:"boolean"},{name:"installed",label:t._({id:"eQkgKV"}),type:"boolean"}]}})]})}export{Fe as default};
